{% extends 'common/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h2 class="fw-bold mb-4">📊 Dashboard</h2>

<div class="accordion" id="dashboardAccordion">
    {% for user in todoappuser_list %}
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ user.pk }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapse{{ user.pk }}" aria-expanded="false"
                        aria-controls="collapse{{ user.pk }}">
                    👤 {{ user.username }}
                </button>
            </h2>
            <div id="collapse{{ user.pk }}" class="accordion-collapse collapse"
                 aria-labelledby="heading{{ user.pk }}" data-bs-parent="#dashboardAccordion">
                <div class="accordion-body">
                    {% if user.tasks.all %}
                        <ul class="list-group">
                            {% for task in user.tasks.all %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        {% if task.completed %}
                                            <span class="text-muted"><s>{{ task.title }}</s></span>
                                        {% else %}
                                            <span>{{ task.title }}</span>
                                        {% endif %}
                                    </div>
                                    <a href="{% url 'task-details' task.pk %}" class="btn btn-sm btn-outline-info">Details</a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">❌ This user has no tasks.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    {% empty %}
        <p class="text-muted">No registered users.</p>
    {% endfor %}
</div>
{% endblock %}
